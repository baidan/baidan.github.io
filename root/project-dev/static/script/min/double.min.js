"use strict";var server=window.location.origin;!function(e){({init:function(){this.initPage(),e(".wrap-con")[0]&&this.loadRes(),e(".register-con")[0]&&this.register()},initPage:function(){var i=e("#wrap"),n=e(window).height(),r=e(document).height(),t=n>r?n:r;e(".mask,.mask2").css("height",t),i.on("click",".btn-share",function(){if(window.isAPP){var i=e("title").html();CallH5ToAPP(8,{title:i,desc:i,url:window.location.href})}else e(".mask-share").show(),e(".mask2").show()}),e(".mask2").click(function(){e(".mask-share").hide(),e(".mask-invite").hide(),e(".mask2").hide()})},loadRes:function(){var i=this,n=e(".load"),r=0;e("#wrap").css("height","1334px");for(var t=["bg.png","bg_foot.png","bg_share.png","bg2.png","bg3.png","close.png","cloud.png","cloud2.png","mo.png","mo2.png","plane.png","redbao.png","share.png","share_arrows.png","title.png","title2.png","title3.png","reg/title.png","reg/bg2.png","reg/icon_imgcode.png","reg/icon_mobile.png","reg/icon_phonecode.png"],o=0,s=t.length;o<s;o++){var a=new Image;a.src=server+"/static/images/double11/"+t[o],a.onload=function(){++r==s&&(n.hide(),i.main())},a.onerror=function(){clearInterval(timer),n.hide(),i.main()}}},getAjax:function(){var i=e(".wrap-con"),n=function(){e.ajax({url:server+"/web/auth",type:"GET",dataType:"json",async:!1,data:{method:"/client/activity/double11/rewardamount"},success:function(e){i.find(".js-total b").html(e.data||0)}})};e.ajax({url:"/web/loginInfo/",type:"GET",dataType:"json",cache:!1,async:!1,success:function(e){e.isLogin?(i.find(".btn-login").hide(),n(),i.find(".js-total").show()):(i.find(".js-total").hide(),i.find(".btn-login").show())}})},main:function(){var i=e(".wrap-con");i.show(),i.on("click",".btn-invite",function(){e(".mask-invite").show(),e(".mask2").show()}),i.on("click",".btn-login",function(){window.isAPP&&(window.isIOS?sessionStorage.apptoh5url="index.html?source=ios_h5_zjcap&WKWebView="+window.WKWebView:sessionStorage.apptoh5url="index.html?source=android_h5_zjcap"),CallH5ToAPP(1,"","",function(){window.location.href=server+"/business/dispatch_get.do?action=doCurrentActivityLogin&h5_support=true"})})},register:function(){var i=this,n=e("#wrap"),r=n.find(".register-con"),t=n.find(".mask"),o=n.find(".mask-verification"),s=n.find(".alert-con"),a=e(window).height(),d=!0;n.css("height",a);var l=function(e,i){n.find(".tips").html(e).show(),setTimeout(function(){n.find(".tips").hide().html("")},i||1500)},c=function(e){s.find(".con").html(e).end().show(),t.show()},u=function(){s.hide(),t.show(),o.show(),o.find(".imgcode").trigger("click")},g=function(e){return e<10?"0"+e:e},p=function(e){var i=60;e.addClass("disabled").attr("disabled",!0).html("60s后获取");var r=setInterval(function(){if(--i<=0)return clearInterval(r),n.find(".input-mobile").attr("disabled",!1).prev("strong").removeClass("disabled"),void e.html("获取验证码").removeClass("disabled").attr("disabled",!1);e.html(g(i)+"s")},1e3)},f=function(i,t){e.ajax({url:"/web/noauth/",type:"GET",dataType:"json",data:{method:"/validate/code/sendinfo",mobilePhone:i},success:function(s){e.ajax({url:"/web/sendregistersmscode",type:"POST",dataType:"json",data:{mobilePhone:i,messageType:1,stringToken:s.data.stringToken,imageToken:o.find(".input-imgcode").val()},success:function(e){"0000"==e.retCode?(n.find(".input-mobile").attr("disabled",!0).prev("strong").addClass("disabled"),p(t),r.find(".btn-phonecode").data("isimg",1),l("验证码发送成功")):d?(d=!1,c(e.retMsg)):(d=!0,r.find(".btn-phonecode").data("isimg",1),r.find(".btn-phonecode").trigger("click"))}})}})};r.on("click",".btn-login",function(){window.isAPP&&(window.isIOS?sessionStorage.apptoh5url="index.html?source=ios_h5_zjcap&WKWebView="+window.WKWebView:sessionStorage.apptoh5url="index.html?source=android_h5_zjcap"),CallH5ToAPP(1,"","",function(){window.location.href=server+"/business/dispatch_get.do?action=doCurrentActivityLogin&h5_support=true"})}),s.on("click",".btn-confirm",function(){s.find(".con").html("").end().hide(),t.hide()}),r.on("keyup",".input-mobile",function(){var i=e(this),n=i.val().replace(/\s/g,"");if(i.val(n),/^(1[34578][0-9])\d{8}$/.test(n)){return n==r.find(".input-referrer").val()?(l("推荐人手机号不允许和注册的手机号相同"),i.addClass("error")):(r.find(".input-referrer").removeClass("error"),r.find(".input-mobile").trigger("blur"),i.removeClass("error"))}return i.addClass("error")}),r.on("blur",".input-mobile",function(){var t=e(this),o=t.val().replace(/\s/g,"");if(n.find(".alert-con:visible")){if(t.val(o),!/^(1[34578][0-9])\d{8}$/.test(o))return t.addClass("error"),l("请输入正确的手机号");var s=r.find(".input-referrer").val();if(o==s)return l("推荐人手机号不允许和注册的手机号相同"),t.addClass("error");r.find(".input-referrer").removeClass("error");var a=JSON.parse(sessionStorage.getItem("checkmobile"));if(a&&a.mobile&&a.mobile==o)return"6006"==a.retCode?(t.get(0).blur(),i.isYet=!0,t.addClass("error"),l("该手机号已注册！")):"0000"!=a.retCode?c(a.retMsg):(t.removeClass("error"),t.get(0).blur(),r.find(".btn-phonecode").removeClass("disabled"),u(),void 0);e.ajax({url:"/web/noauth",type:"GET",dataType:"json",async:!1,data:{method:"/register/mobile/check",mobilePhone:o},success:function(e){var n={mobile:o,retCode:e.retCode,retMsg:e.retMsg};return sessionStorage.setItem("checkmobile",JSON.stringify(n)),"6006"==e.retCode?(t.get(0).blur(),i.isYet=!0,t.addClass("error"),l("该手机号已注册！")):"0000"!=e.retCode?c(e.retMsg):(t.removeClass("error"),t.get(0).blur(),r.find(".btn-phonecode").removeClass("disabled"),u(),void 0)}})}}),r.on("keyup",".input-phonecode",function(){var i=e(this),n=i.val().replace(/\s/g,"");return i.val(n),/^\d{6}$/i.test(n)?(r.find(".input-phonecode").trigger("blur"),i.removeClass("error")):i.addClass("error")}),r.on("blur",".input-phonecode",function(){var i=e(this),n=i.val().replace(/\s/g,"");return/^(1[34578][0-9])\d{8}$/.test(r.find(".input-mobile").val())?(i.val(n),/^\d{6}$/i.test(n)?(i.removeClass("error"),/^[a-z0-9]{4}$/i.test(o.find(".input-imgcode").val())?void r.find(".btn-register").removeClass("disabled"):o.find(".input-imgcode").addClass("error")):(i.addClass("error"),i.get(0).blur(),void r.find(".btn-register").addClass("disabled"))):r.find(".input-mobile").addClass("error")}),o.on("click",".imgcode",function(){var i=r.find(".input-mobile").val();e(this).attr("src",server+"/validcode/generate-validcode-api.do?mobilePhone="+i+"&_="+Math.random()),o.find(".input-imgcode").val("")}),o.on("click",".btn-cancel",function(){o.hide(),t.hide()}),o.on("keyup",".input-imgcode",function(){var i=e(this),n=i.val().replace(/\s/g,"");return i.val(n),/^[a-z0-9]{4}$/i.test(n)?i.removeClass("error"):i.addClass("error")}),o.on("blur",".input-imgcode",function(){var i=e(this),n=i.val().replace(/\s/g,"");if(i.val(n),!/^[a-z0-9]{4}$/i.test(n))return i.val("").addClass("error"),i.next(".imgcode").trigger("click"),l("验证码不正确");i.removeClass("error")}),o.on("click",".btn-confirm",function(){o.find(".input-imgcode").trigger("blur"),o.find(".input-imgcode").hasClass("error")||(o.hide(),t.hide(),r.find(".btn-phonecode").removeClass("disabled").data("isimg",2).trigger("click"))}),r.on("click",".btn-phonecode",function(){var r=e(this),t=n.find(".input-mobile"),o=t.val().replace(/\s/g,"");if(!r.hasClass("disabled")){if(!/^(1[34578][0-9])\d{8}$/.test(o))return;if(t.hasClass("error"))return;2==r.data("isimg")?f(o,r):(i.isYet||n.find(".input-mobile").trigger("blur"),i.isYet=!1,n.find(".input-phonecode").val(""),n.find(".btn-register").addClass("disabled"))}}),r.on("keyup",".input-referrer",function(){var i=e(this),n=i.val();if(n){if(n=n.replace(/\s/g,""),i.val(n),/^(1[34578][0-9])\d{8}$/.test(n)){return n==r.find(".input-mobile").val()?(l("推荐人手机号不允许和注册的手机号相同"),i.addClass("error")):i.removeClass("error")}return i.addClass("error")}i.removeClass("error")}),r.on("blur",".input-referrer",function(){var i=e(this),n=i.val();if(i.val(n),n){if(n=n.replace(/\s/g,""),i.val(n),/^(1[34578][0-9])\d{8}$/.test(n)){return n==r.find(".input-mobile").val()?(l("推荐人手机号不允许和注册的手机号相同"),i.addClass("error")):i.removeClass("error")}return i.addClass("error"),l("请输入正确的手机号")}i.removeClass("error")}),n.on("click",".btn-register",function(){var i=e(this);return n.find(".input-mobile").val()?n.find(".input-phonecode").val()?void(n.find(".error").length>0||i.hasClass("disabled")||(i.addClass("disabled"),e.ajax({url:"/web/registerandlogin",type:"GET",dataType:"json",data:{smsVerifyCode:n.find(".input-phonecode").val().replace(/\s/g,""),mobilePhone:n.find(".input-mobile").val().replace(/\s/g,""),introducer:n.find(".input-referrer").val().replace(/\s/g,"")},success:function(e){"0000"==e.retCode?(l("注册成功，请查收短信！"),setTimeout(function(){sessionStorage.removeItem("checkmobile"),window.location.href="index.html"},1500)):(i.removeClass("disabled"),c(e.retMsg))}}))):void n.find(".input-phonecode").trigger("keyup"):void n.find(".input-mobile").trigger("keyup")})}}).init()}(jQuery);